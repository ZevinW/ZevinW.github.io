<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ZevinW's Blog</title><meta name="author" content="ZevinW"><meta name="copyright" content="ZevinW"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="ZevinW&#39;s Blog">
<meta property="og:url" content="https://zevinw.github.io/index.html">
<meta property="og:site_name" content="ZevinW&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zevinw.github.io/images/back.png">
<meta property="article:author" content="ZevinW">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zevinw.github.io/images/back.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zevinw.github.io/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ZevinW\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-07-01 09:42:22'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/back.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/images/back.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ZevinW's Blog"><span class="site-name">ZevinW's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">ZevinW's Blog</h1></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2024/07/01/%E5%BC%82%E6%AD%A5/" title="异步"><img class="post-bg" src="/images/asynchronous/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="异步"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/01/%E5%BC%82%E6%AD%A5/" title="异步">异步</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-01T01:33:38.000Z" title="发表于 2024-07-01 09:33:38">2024-07-01</time></span></div><div class="content">同步方法里调用异步场景：

构造函数里使用异步
实现异步接口
维护旧代码，避免异步污染

123static  async Task FooAsync()&#123;    await Task.Delay(1000);&#125;

阻塞(需要时刻关注死锁问题).Wait(),.Result()抛出的异常是 IAggregateException (异步的异常会聚合，实际的异常在其内部的 InnerException
)
.GetAwaiter().GetResult() 【非要阻塞的形式使用，建议用这个】抛出的异常不是包装的 IAggregateException ，而直接时 Exception
不阻塞的直接调用的问题1234567891011121314151617181920212223static void Main(string[] arg)&#123;    try&#123;        _ = FooAsync(); // 弃元， 放弃返回值不被需要，避免编译器报错未等待        Console.WriteLine(&quot;Hello World!&quo ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/05/16/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" title="线程安全"><img class="post-bg" src="/images/TaskSafe/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线程安全"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/05/16/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" title="线程安全">线程安全</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-05-16T11:36:21.000Z" title="发表于 2024-05-16 19:36:21">2024-05-16</time></span></div><div class="content">线程安全多个线程访问共享资源时，对共享资源的访问不会导致数据不一致。
即: 当对同一个资源进行读写的时候，要使资源在同一时刻只能被一个线程操作，以确保每个操作
都是有效即时的，也即保证其操作的原子性。（同步机制）
Locklock(object)&#123;code&#125; – 锁对象
object 有没有被锁定，没有的话我来锁，否则一直等待，在我 lock 期间吗，其他线程不能调用code,
也不能使用object, 执行code 之后释放object ，并且code 可以被其他线程访问。锁定的是当前的代码块。
lock(this) – 锁当前对象
用于锁定这个一个对象，它的作用是锁定整个对象，当前对象不能被访问。
原子性
Interlocked.Incremer(ref count)；
监视器类Monitor提供了一种同步对象访问的机制。像锁一样，用来保护多线程环境中的共享资源在并发中
免受污染。
123456Enter() : 在指定对象上获取一个独占锁，标识其他线程不能访问下面的代码Exit(): 释放指定对象上的锁。标识共享资源的保护结束Pules(）: 它会向等待队列中 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/05/16/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="中间件"><img class="post-bg" src="/images/middleware/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="中间件"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/05/16/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="中间件">中间件</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-05-16T06:38:14.000Z" title="发表于 2024-05-16 14:38:14">2024-05-16</time></span></div><div class="content">中间件关键字是一种装配到应用管道以处理请求和响应的软件。 每个组件：

选择是否将请求传递到管道中的下一个组件。
可在管道中的下一个组件前后执行工作。

请求委托用于生成请求管道。请求委托处理每个HTTP请求。
使用RunMap 和 Use 扩展方法来配置请求委托。
可将一个单独的请求委托并行指定为匿名方法（称为并行中间件），或在可重用的类
中对其进行定义。这些可重用的类和并行匿名方法即为中间件，也叫中间件组件。
请求管道中的每个中间件组件负责调用管道中的下一个组件，或使管道短路。当中间件短路时，它被称为“终端中间件”，因为它阻止中间件进一步处理请求。

Run 的使用 （终结点）Run:　使管道短路，Run后的代码都不会被执行，所以也叫终节点中间件，这就是为什么 app.Run() ;
要放到最后面的原因。

注： 即便在框架内置中间件前 添加了 app.Run() 的代码。调试时也是先执行内置的中间件
原因：.NET 会在 CRL 这里对代码进行优化。即便把 代码也在了上面，但是CRL 会对你这个代码进行优化。
Use 的 使用 （短路）可以使管道短路
通过不调用 next.Inv ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/05/16/hello-world/" title="Hello World"><img class="post-bg" src="/images/hello-world/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/05/16/hello-world/" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-05-16T04:38:14.000Z" title="发表于 2024-05-16 12:38:14">2024-05-16</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/back.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ZevinW</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/01/%E5%BC%82%E6%AD%A5/" title="异步"><img src="/images/asynchronous/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="异步"/></a><div class="content"><a class="title" href="/2024/07/01/%E5%BC%82%E6%AD%A5/" title="异步">异步</a><time datetime="2024-07-01T01:33:38.000Z" title="发表于 2024-07-01 09:33:38">2024-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/16/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" title="线程安全"><img src="/images/TaskSafe/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线程安全"/></a><div class="content"><a class="title" href="/2024/05/16/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" title="线程安全">线程安全</a><time datetime="2024-05-16T11:36:21.000Z" title="发表于 2024-05-16 19:36:21">2024-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/16/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="中间件"><img src="/images/middleware/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="中间件"/></a><div class="content"><a class="title" href="/2024/05/16/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="中间件">中间件</a><time datetime="2024-05-16T06:38:14.000Z" title="发表于 2024-05-16 14:38:14">2024-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/16/hello-world/" title="Hello World"><img src="/images/hello-world/back.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2024/05/16/hello-world/" title="Hello World">Hello World</a><time datetime="2024-05-16T04:38:14.000Z" title="发表于 2024-05-16 12:38:14">2024-05-16</time></div></div></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><span class="card-archive-list-count">3</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">4</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2024-05-15T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-07-01T01:42:21.933Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By ZevinW</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>